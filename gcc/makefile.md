# Makefile

## 1.定义

- 一个工程中的源文件不计其数，其按类型、功能、模块分别放在若干目录中。Makefile文件定义了一系列的规则来指定哪些文件需要先编译，哪些文件需要后编译等，甚至更复杂的功能操作。就像Shell脚本一样，可以执行操作系统的命令。
- Makefile带来的好处是”自动化编译“，一旦写好，只需要一个make命令。

## 2.文件命名和规则

- 文件命名

makefile或者Makefile

- Makefile规则

  - 一个Makefile文件中可以有一个或者多个规则

  ```shell
  目标 ：依赖
  	命令（Shell命令）
  	...
  ```

  -- 目标：最终生成的文件

  -- 依赖：生成目标所需要的文件或是目标

  -- 命令：通过执行命令对依赖操作生成目标（必须Tab缩进）

  - Makefile中的其它规则一般都是为第一条规则服务的。

- 命令在执行之前，需要先检查规则中的依赖是否存在

  - 如果存在，执行命令
  - 否则，向下检查

- 检测更新，在执行命令时，会比较目标和依赖的时间。

## 3.变量

- 自定义变量

变量名=变量值

```shell
var=hello    $(var)
```

- 预定义变量
  - AR：归档维护程序的名称，默认值为ar
  - CC：c编译器的名称，默认值为cc
  - CXX：c++编译器的额命名成，默认值为g++
  - $@:
  - $<:
  - $^:
- 获取变量的值：
  $(变量名)

## 4.模式匹配

%.o : %.c

		- %: 通配符，匹配一个字符串
		- 两个%匹配的是同一个字符串

## 5.函数

- $(wildcard PATTERN ...)

  - 功能：获取指定目录次啊指定类型的文件列表

  - 参数：PATTERN指的是某个或多个目录下的对应的某种类型的文件，如果有多个目录，使用空格隔开

  - 返回：得到的若干个文件的文件列表，文件名之前使用空格间隔

  - 示例：

    ```
    $(wildcard *.c ./sub/*.c)
    
    返回格式：a.c  b.c  c.c  d.c
    ```

- $(patsubst  <pattern>,<replacement>,<text>)
  - 
